@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Forestry.Flo.Internal.Web.Infrastructure.Display
@using Forestry.Flo.Services.FellingLicenceApplications.Entities
@model Forestry.Flo.Internal.Web.Models.FellingLicenceApplication.FellingLicenceApplicationReviewSummaryModel
@{
    ViewData["Title"] = "Application summary";
}

<div class="govuk-grid-column-full" id="summary-container">
<h1 class="govuk-heading-xl">
    Application @Model.FellingLicenceApplicationSummary!.ApplicationReference
</h1>
<partial name="Partials/_ConfirmationMessageDisplay"/>
<partial name="Partials/_UserGuideDisplay"/>
<partial name="Partials/_FellingLicenceApplicationSummary" model="@Model.FellingLicenceApplicationSummary"/>

<div class="govuk-grid-column-full">
<div class="govuk-button-group">
    <a class="govuk-button govuk-button--secondary" data-module="govuk-button" asp-controller="AdminOfficerReview" asp-action="Index" asp-route-id="@Model.Id">
        Operations admin officer review
    </a>
    <a id="mapButton" data-module="govuk-button" class="govuk-button govuk-button--secondary">
        Generate images
    </a>
    <a condition="@(Model.FellingLicenceApplicationSummary.StatusHistories.Any(x => x.Status == FellingLicenceStatus.WoodlandOfficerReview))" class="govuk-button govuk-button--secondary" data-module="govuk-button" asp-controller="WoodlandOfficerReview" asp-action="Index" asp-route-id="@Model.Id">
        Woodland officer review
    </a>
    <a condition="@(Model.FellingLicenceApplicationSummary.StatusHistories.Any(x => x.Status == FellingLicenceStatus.SentForApproval))" class="govuk-button govuk-button--secondary" data-module="govuk-button" asp-controller="ApproverReview" asp-action="Index" asp-route-id="@Model.Id">
        Approver review
    </a>
</div>

<input type="hidden" id="runningMode" value="felling"/>
<input type="hidden" id="printer-runningMode" value="felling"/>
@if (Model.FellingAndRestockingDetail?.DetailsList is not null)
{
    @foreach (var item in Model.FellingAndRestockingDetail!.DetailsList!)
    {
        <input type="hidden" id="@item.CompartmentId" value="@item.GISData" data-label="@item.CompartmentName" data-group="compartments_GIS" data-type="felling"/>
        @foreach (var restocking in item.RestockingDetail)
        {
            <input type="hidden" id="@restocking.RestockingCompartmentId" value="@restocking.GISData" data-label="@restocking.RestockingCompartmentName" data-group="compartments_GIS" data-type="restocking"/>
        }
    }
}
<div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
    <div id="compartments-display">
        <div class="govuk-accordion__section ">
            <div class="govuk-accordion__section-header">
                <h2 class="govuk-accordion__section-heading">
                    <span class="govuk-accordion__section-button" id="accordion-default-heading-1">
                        Compartment map
                    </span>
                </h2>
            </div>
            <div id="accordion-default-content-1" class="govuk-accordion__section-content" aria-labelledby="accordion-default-heading-1">
                <calcite-shell id="shell" content-behind>
                    <h2 id="header-title" slot="header">
                        Felling
                    </h2>
                    <calcite-shell-panel id="panelMenu" slot="panel-start" display-mode="float" detached closed>

                        <calcite-action-bar slot="action-bar" expanded>
                            <calcite-action data-action-id="basemaps"
                                            icon="basemap"
                                            text="Basemaps"
                                            scale="l" text-enabled>
                            </calcite-action>
                            <calcite-action id="view"
                                            icon="analysis"
                                            text="View Restocking"
                                            scale="l" text-enabled>
                            </calcite-action>
                        </calcite-action-bar>

                        <calcite-panel heading="Basemap Selection" description="Please select an base map to view" height-scale="s" data-panel-id="basemaps" hidden>
                            <calcite-action icon="question" text="Help" slot="header-actions-start" id="help-basemap-button" scale="s"></calcite-action>
                            <calcite-action icon="x" text="close" slot="header-actions-end" id="close-basemap-button" scale="s"></calcite-action>
                            <div id="basemaps-container">
                                <arcgis-basemap-gallery></arcgis-basemap-gallery>
                            </div>
                        </calcite-panel>

                    </calcite-shell-panel>
                    <arcgis-map id="viewDivMain" class="profileMap">
                        <arcgis-scale-bar slot="bottom-right" unit="dual"></arcgis-scale-bar>
                        <arcgis-zoom slot="top-right"></arcgis-zoom>
                        <arcgis-compass slot="top-right"></arcgis-compass>
                    </arcgis-map>

                </calcite-shell>
            </div>
        </div>
    </div>

    <partial name="Partials/_FellingLicenceApplicationInfoTabs" model="@Model"/>


</div>
<div class="modal" id="modal">
    <div class="modal-bg modal-exit"></div>
    <div class="modal-container">
        <calcite-shell id="printer-shell" content-behind>
            <h2 id="printer-header-title" slot="header">
                Generate Image - Felling
            </h2>
            <calcite-shell-panel id="printer-panel-Menu" slot="panel-start" display-mode="float" detached>
                <calcite-action-bar slot="action-bar" id="printer-action-bar" expanded>
                    <calcite-action data-action-id="printer-basemaps"
                                    icon="basemap"
                                    text="Basemaps"
                                    scale="l" text-enabled>
                    </calcite-action>
                    <calcite-action id="printer-view"
                                    icon="analysis"
                                    text="View Restocking"
                                    scale="l" text-enabled>
                    </calcite-action>
                    <calcite-action data-action-id="printer-show-hide"
                                    icon="access-string-results"
                                    text="Toggle visability"
                                    scale="l" text-enabled>
                    </calcite-action>
                    <calcite-action data-action-id="printer-symbol-editor"
                                    icon="access-string-results"
                                    text="Edit Symbol"
                                    scale="l" text-enabled>
                    </calcite-action>

                    <calcite-action data-action-id="printer-export"
                                    icon="access-string-results"
                                    text="Export"
                                    scale="l" text-enabled>
                    </calcite-action>

                </calcite-action-bar>

                <calcite-panel heading="Basemap Selection" description="Please select an base map to view" height-scale="s" data-panel-id="printer-basemaps" hidden>
                    <calcite-action icon="question" text="Help" slot="header-actions-start" id="help-printer-basemap-button" scale="s"></calcite-action>
                    <calcite-action icon="x" text="close" slot="header-actions-end" id="close-printer-basemap-button" scale="s"></calcite-action>
                    <div id="printer-basemaps-container">
                        <arcgis-basemap-gallery></arcgis-basemap-gallery>
                    </div>
                </calcite-panel>


                <calcite-panel heading="Export Tool" height-scale="s" data-panel-id="printer-export" hidden>
                    <calcite-action icon="question" text="Help" slot="header-actions-start" id="help-printer-export-button" scale="s"></calcite-action>
                    <calcite-action icon="x" text="close" slot="header-actions-end" id="close-printer-export-button" scale="s"></calcite-action>
                    <div id="printer-export-container">
                        <arcgis-print></arcgis-print>
                    </div>
                </calcite-panel>

                <calcite-panel heading="Show/ Hide Compartments" description="Please use the tool to show or hide the compartments" height-scale="s" data-panel-id="printer-show-hide" hidden>
                    <calcite-action icon="question" text="Help" slot="header-actions-start" id="help-printer-show-hide-button" scale="s"></calcite-action>
                    <calcite-action icon="x" text="close" slot="header-actions-end" id="close-printer-show-hide-button" scale="s"></calcite-action>
                    <div style="max-height: 500px;overflow: auto;resize: vertical;">
                        <calcite-list label="Compartments" id="printer-compartments-list">
                        </calcite-list>
                    </div>
                </calcite-panel>

                <calcite-panel heading="Edit Symbols" description="Please use the tool to change the style of the compartment" height-scale="s" data-panel-id="printer-symbol-editor" hidden>
                    <calcite-action icon="question" text="Help" slot="header-actions-start" id="help-printer-symbol-editor-button" scale="s"></calcite-action>
                    <calcite-action icon="x" text="close" slot="header-actions-end" id="close-printer-symbol-editor-button" scale="s"></calcite-action>
                    <div style="max-height: 500px;overflow: auto;resize: vertical;">
                        <calcite-block width="200px"
                                       key="nullOption"
                                       id="printer-no-shape-selected"
                                       heading="No Shape Selected">
                            <calcite-icon
                                scale="s"
                                slot="icon"
                                icon="exclamation-mark-triangle">
                            </calcite-icon>
                            <calcite-notice expanded>
                                <div slot="message">Please select shape to edit symbols</div>
                            </calcite-notice>
                        </calcite-block>
                        <calcite-block key="polygonSymbol"
                                       collapsible
                                       expanded
                                       id="printer-polygon-symbol"
                                       heading="Polygon Style">
                            <calcite-icon scale="s" slot="icon" icon="polygon"></calcite-icon>
                            <calcite-label>
                                style
                                <select id="ployon-shape-symbol">
                                    <option>backward-diagonal</option>
                                    <option>cross</option>
                                    <option>diagonal-cross</option>
                                    <option>forward-diagonal</option>
                                    <option>horizontal</option>
                                    <option>none</option>
                                    <option>solid</option>
                                    <option>vertical</option>
                                </select>
                            </calcite-label>
                            <calcite-label>
                                Fill
                                <input type="color" id="ployon-shape-color"/>
                            </calcite-label>
                            <calcite-block-section expanded text="Outline" toggle-display="button">
                                <calcite-notice expanded>
                                    <div slot="message">
                                        <calcite-label>
                                            Color
                                            <input type="color"
                                                   id="ploygon-line-color"/>
                                        </calcite-label>
                                        <calcite-label>
                                            Width
                                            <input type="number"
                                                   min="0"
                                                   step="0.25"
                                                   id="ploygon-line-width"/>
                                        </calcite-label>
                                    </div>
                                </calcite-notice>
                            </calcite-block-section>
                        </calcite-block>
                        <calcite-block key="LabelSymbol" id="printer-label-symbol" collapsible heading="Label Style" expanded>
                            <calcite-icon scale="s" slot="icon" icon="label"></calcite-icon>
                            <calcite-label>
                                Text
                                <input type="text"
                                       id="printer-label-text"/>
                            </calcite-label>
                            <calcite-label>
                                Color
                                <input type="color"
                                       id="printer-label-color"/>
                            </calcite-label>
                            <calcite-label>
                                Halo Color
                                <input type="color"
                                       id="printer-halo-color"/>
                            </calcite-label>
                            <calcite-label>
                                Halo Size
                                <input type="number"
                                       min="0"
                                       step="1"
                                       max={(this.shape.labelSymbol as any).font.size}
                                       id="printer-halo-size"/>
                            </calcite-label>
                            <calcite-label>
                                X-Offset
                                <input type="number"
                                       min="0"
                                       step="1"
                                       id="printer-label-x-offset"/>
                            </calcite-label>
                            <calcite-label>
                                Y-Offset
                                <input type="number"
                                       min="0"
                                       step="1"
                                       id="printer-label-y-offset"/>
                            </calcite-label>
                            <calcite-block-section expanded text="Font" toggle-display="button">
                                <calcite-notice expanded>
                                    <div slot="message">
                                        <calcite-label>
                                            Size
                                            <input type="number"
                                                   min="0"
                                                   step="1"
                                                   max={100}
                                                   id="printer-font-size"/>
                                        </calcite-label>
                                        <calcite-label>
                                            style
                                            <select id="printer-font-weight">
                                                <option value="normal">normal</option>
                                                <option value="bold">bold</option>
                                                <option value="bolder">bolder</option>
                                                <option value="lighter">lighter</option>
                                            </select>
                                        </calcite-label>
                                    </div>
                                </calcite-notice>
                            </calcite-block-section>
                        </calcite-block>
                    </div>
                </calcite-panel>

            </calcite-shell-panel>
            <arcgis-map class="printerDiv" id="printerDiv">
                <arcgis-scale-bar slot="bottom-right" unit="dual"></arcgis-scale-bar>
                <arcgis-zoom slot="top-right"></arcgis-zoom>
                <arcgis-compass slot="top-right"></arcgis-compass>
            </arcgis-map>
        </calcite-shell>

        <input type="button" class="modal-close modal-exit" id="close_modal" value="x"/>
    </div>
</div>
</div>
</div>

@section breadcrumbs
{
    <partial name="Partials/_BreadcrumbsMenu" model="@Model.Breadcrumbs"/>
}

@section Scripts
{
    <script src="~/js/display-user-icon.js" asp-append-version="true"></script>
    <partial name="Partials/_DataTablesJs"/>
    <script src="~/js/compartment-list.js" asp-append-version="true"></script>
    <script src="~/js/add-case-note.js" asp-append-version="true"></script>
    <script src="~/js/supporting-documentation.js" asp-append-version="true"></script>
    <script src="~/js/filter-activity-feed.js" asp-append-version="true"></script>


    <script src="https://js.arcgis.com/calcite-components/3.3.3/calcite.esm.js" type="module"></script>
    <script src="https://js.arcgis.com/4.34/"></script>
    <script type="module" src="https://js.arcgis.com/4.34/map-components/"></script>
    <script>

        document.getElementById("mapButton").addEventListener("click", function (evt) {
            evt.preventDefault();
            document.getElementById('modal').classList.add("open");
        });

        document.getElementById("close_modal").addEventListener("click", function hideModal(evt) {
            document.getElementById('modal').classList.remove("open");
        });

    </script>
    <script type="module">
        require(["../../js/mapping/maps/map-printer.js"], function (PrinterMap) {
            var mapObj = new PrinterMap("printerDiv");
        });

        require(["../../js/mapping/maps/map-profile-page.js?v=" + Date.now()], function (ProfileMap) {
            var mapObj = new ProfileMap("viewDivMain", true);
        });
    </script>
}

@section Css {
    <link rel="stylesheet" href="@Url.AbsoluteContent("~/css/map.css")"/>
    <link rel="stylesheet" href="~/css/assign-fla-select-user.css" aria-busyasp-append-version="true"/>
    <link rel="stylesheet" href="~/css/application-summary.css" aria-busyasp-append-version="true"/>
    <link rel="stylesheet" href="https://js.arcgis.com/4.34/esri/themes/light/main.css"/>

    <style>
        #shell {
            position: unset !important;
            height: 600px;
        }

        #viewDivMain {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        calcite-shell-panel[closed] {
            display: none !important;
        }
    </style>
}